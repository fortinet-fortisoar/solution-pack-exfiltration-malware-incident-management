{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "02 - Get Logged On User",
    "aliasName": null,
    "tag": null,
    "description": "Identify the user account logged on the device exfiltrating data",
    "isActive": true,
    "debug": true,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "force_manual_input",
        "record"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/26d51696-4c4a-4f19-aabe-70fa9c9bbf2d",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/73f9b6d6-e242-4246-afbd-90271c7cda6f",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "_GC_ Hunt Exfiltration Process",
            "description": null,
            "arguments": {
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "alerts": "{{vars.input.records[0]['@id']}}",
                    "people": [],
                    "content": "<p>{{globalVars.Action_Icon}} <strong>Run playbook : <span style=\"background-color: #e67e23;\">Hunt Exfiltration Process<\/span><\/strong><strong> <\/strong>to identify the process sending data out.<\/p>\n<p>If found the <span style=\"color: #e67e23;\"><strong>process indicator<\/strong><\/span> will be linked to the current ticket, you can find it under <span style=\"color: #e67e23;\"><strong>Indicators<\/strong><\/span><\/p>",
                    "__replace": "",
                    "isImportant": false,
                    "peopleUpdated": false
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "4c699825-a1cf-4602-ab2c-24126e811fa7"
        },
        {
            "@type": "WorkflowStep",
            "name": "_GC_ Hunt Process Name",
            "description": null,
            "arguments": {
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "alerts": "{{vars.input.records[0]['@id']}}",
                    "people": [],
                    "content": "<p>{{globalVars.Hint_Icon}} To find the process name, FortiSOAR uses the destination IP of the exfiltration alert as a filter on a FortiSIEM search query. Correlating the IP (<span style=\"color: #e67e23;\"><strong>{{vars.input.records[0].destinationIp}}<\/strong><\/span>) from the exfiltration with the endpoints network activity events help pinpointing the process at the origin of the exfiltration.<\/p>\n<p>The search\/hunt results are found under <span style=\"color: #e67e23;\"><strong>Correlations &gt;&gt; Events<\/strong><\/span><\/p>",
                    "__replace": "",
                    "isImportant": false,
                    "peopleUpdated": false
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "28186ca1-a909-4cd3-b3be-d94b066b911b"
        },
        {
            "@type": "WorkflowStep",
            "name": "_GC_ Manual Username Entry",
            "description": null,
            "arguments": {
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "alerts": "{{vars.input.records[0]['@id']}}",
                    "people": [],
                    "content": "<p>User <span style=\"color: #e67e23;\"><strong>{{vars.username}}<\/strong><\/span> has been created <a href=\"{{vars.user_iri|iriToLink}}\" target=\"_blank\" rel=\"noopener\">Click Here<\/a> to open it<\/p>",
                    "__replace": "",
                    "isImportant": false,
                    "peopleUpdated": false
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "bd83a28e-711c-4eac-9ce5-11acc9462c65"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Logged On User",
            "description": null,
            "arguments": {
                "arguments": {
                    "device_ip_address": "{{vars.input.records[0].sourceIp}}",
                    "parent_object_iri": "{{vars.input.records[0]['@id']}}",
                    "force_manual_input": "{{ False if vars.force_manual_input else True }}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/a80ae419-f8de-490d-867f-5f974f9b493d"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "8acf440c-abae-423c-9126-3518d15949cc"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get User Details",
            "description": null,
            "arguments": {
                "user_iri": "{{vars.steps.Get_Logged_On_User.user_iri}}",
                "username": "{{vars.steps.Get_Logged_On_User.username}}"
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "9dc1ee1a-297a-4ec3-a8c4-698d5e03f9e1"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "3a841655-b3f2-4f63-89c6-3033be16230f",
                "resources": [
                    "alerts"
                ],
                "inputVariables": [],
                "step_variables": {
                    "_tmp": "{%if vars.input.records|length == 0%}{{vars.input.records.append(vars.input.params.record)}}{%endif%}",
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    },
                    "force_manual_input": "{{vars.input.params['force_manual_input']}}"
                },
                "displayConditions": {
                    "alerts": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": [
                            {
                                "type": "array",
                                "field": "type",
                                "value": [
                                    "\/api\/3\/picklists\/a043fb35-f373-44c0-bfa9-5bce2f711141",
                                    "\/api\/3\/picklists\/0cbc2c31-c360-4770-b1e7-3653a8c24ead"
                                ],
                                "module": "type",
                                "display": "",
                                "operator": "in",
                                "template": "multiselectpicklist",
                                "OPERATOR_KEY": "$",
                                "useInOperator": true,
                                "previousOperator": "in",
                                "previousTemplate": "multiselectpicklist"
                            },
                            {
                                "type": "array",
                                "field": "recordTags",
                                "value": [
                                    "\/api\/3\/tags\/SIM",
                                    "\/api\/3\/tags\/MIM"
                                ],
                                "module": "recordTags",
                                "display": "",
                                "operator": "in_all",
                                "template": "tags",
                                "OPERATOR_KEY": "$",
                                "previousOperator": "in_all",
                                "previousTemplate": "tags"
                            }
                        ]
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "73f9b6d6-e242-4246-afbd-90271c7cda6f"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update Previous Comment",
            "description": null,
            "arguments": {
                "arguments": {
                    "comments_iris": "{{vars.steps._GC__Hunt_Exfiltration_Process['@id']}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/1349e234-0b21-4e57-b781-2c9f72a679f1"
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "7be2b201-68ea-403a-9dd0-a155ac6bdfb9"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "_GC_ Hunt Exfiltration Process -> Update Previous Comment",
            "targetStep": "\/api\/3\/workflow_steps\/7be2b201-68ea-403a-9dd0-a155ac6bdfb9",
            "sourceStep": "\/api\/3\/workflow_steps\/4c699825-a1cf-4602-ab2c-24126e811fa7",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "a2db1c3d-2ac1-4c11-a18e-5d1cab2e7458"
        },
        {
            "@type": "WorkflowRoute",
            "name": "_GC_ Manual Username Entry -> _GC_ Hunt Process Name",
            "targetStep": "\/api\/3\/workflow_steps\/28186ca1-a909-4cd3-b3be-d94b066b911b",
            "sourceStep": "\/api\/3\/workflow_steps\/bd83a28e-711c-4eac-9ce5-11acc9462c65",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "b450731e-8dc4-4e00-ab5d-fae8b4e53032"
        },
        {
            "@type": "WorkflowRoute",
            "name": "_GC_ Populated Alert Fields -> _GC_ Hunt Exfiltration Process",
            "targetStep": "\/api\/3\/workflow_steps\/4c699825-a1cf-4602-ab2c-24126e811fa7",
            "sourceStep": "\/api\/3\/workflow_steps\/28186ca1-a909-4cd3-b3be-d94b066b911b",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "a18b780a-cfb9-45d0-a0ef-4a2ae4069c88"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Logged On User -> Get User Details",
            "targetStep": "\/api\/3\/workflow_steps\/9dc1ee1a-297a-4ec3-a8c4-698d5e03f9e1",
            "sourceStep": "\/api\/3\/workflow_steps\/8acf440c-abae-423c-9126-3518d15949cc",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "def643cd-dbdc-4ea9-8bc0-82002b69cd3f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get User Details -> _GC_ Manual Username Entry",
            "targetStep": "\/api\/3\/workflow_steps\/bd83a28e-711c-4eac-9ce5-11acc9462c65",
            "sourceStep": "\/api\/3\/workflow_steps\/9dc1ee1a-297a-4ec3-a8c4-698d5e03f9e1",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "ea7c394a-5560-445e-acac-b3022cf4e54a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Get Logged On User",
            "targetStep": "\/api\/3\/workflow_steps\/8acf440c-abae-423c-9126-3518d15949cc",
            "sourceStep": "\/api\/3\/workflow_steps\/73f9b6d6-e242-4246-afbd-90271c7cda6f",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "2720bb5b-1b9e-4c1c-b674-713cced4a847"
        }
    ],
    "groups": [
        {
            "@type": "WorkflowGroup",
            "name": "Get Logged On User",
            "description": "If executed individually, the playbook will attempt to get the logged on user from SIEM logs. If it fails it will prompt the user via a Manual Input to enter the username. If Auto-triage is executed a random username will be used",
            "type": "note",
            "isCollapsed": false,
            "hasTriggerStep": false,
            "hideInLogs": true,
            "metadata": [],
            "reusable": false,
            "top": "120",
            "left": "400",
            "height": "123",
            "width": "498",
            "uuid": "7f608158-4f2e-4aa0-97b7-99340c7dea12",
            "recordTags": []
        },
        {
            "@type": "WorkflowGroup",
            "name": "Update Previous Comment",
            "description": "The global variable: DBD_Last_Task_Comment_IRI is used to store the current comments IDs (Comment with tasks) when this playbook is executed it populates the global variable with the ID of the current comment and tags the previous ones as DONE",
            "type": "note",
            "isCollapsed": false,
            "hasTriggerStep": false,
            "hideInLogs": true,
            "metadata": [],
            "reusable": false,
            "top": "820",
            "left": "400",
            "height": "121",
            "width": "498",
            "uuid": "875c9782-e8da-4176-b13d-7a6c2ff09c0d",
            "recordTags": []
        }
    ],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "fbdd9b64-dfd8-439b-96a3-cd742f4249f7",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Enrichment"
    ]
}