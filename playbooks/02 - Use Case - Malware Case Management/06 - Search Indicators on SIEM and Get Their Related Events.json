{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "06 - Search Indicators on SIEM and Get Their Related Events",
    "aliasName": null,
    "tag": null,
    "description": "Tracks malware origin and fetches it if it's downloadable",
    "isActive": true,
    "debug": true,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/26d51696-4c4a-4f19-aabe-70fa9c9bbf2d",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/d70bf103-bfed-49bc-b1f6-b4a65913deb7",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "_GC_ Identify Dropper Origin",
            "description": null,
            "arguments": {
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "events": "{{vars.events_iris}}",
                    "people": [],
                    "content": "<p>{{globalVars.Action_Icon}}<\/p>\n<p>- <a href=\"{{vars.events_iris.0|iriToLink}}\" target=\"_blank\" rel=\"noopener\"><span style=\"background-color: #e67e23;\"><span style=\"color: #000000;\"><strong>Click Here<\/strong><\/span><\/span> <\/a>to open the newly created indicator from your search keyword<\/p>\n<p>- If you find new indicators in the fetched events add them manually to the incident<\/p>\n<p>- From the <span style=\"color: #e67e23;\"><strong>Incident page<\/strong><\/span>, Run The playbook: <span style=\"background-color: #e67e23;\"><span style=\"color: #ffffff;\"><strong>Malware Incident Remediation<\/strong><\/span><\/span><span style=\"color: #ffffff;\"><strong> <\/strong><\/span>to trigger the automated remediation<\/p>",
                    "__replace": "",
                    "incidents": "{{vars.incident_iri}}",
                    "indicators": "{{vars.indicators_iris}}",
                    "isImportant": false,
                    "peopleUpdated": false
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "ccb1ae24-6715-4075-bfb7-718e917ff833"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Events IRIs",
            "description": null,
            "arguments": {
                "__apnd_iri": "{{vars.events_iris.append(vars.input.records[0]['@id'])}}"
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "bdbb9062-8296-4710-a363-f7e04d9b4e56"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Incidents IRI",
            "description": null,
            "arguments": {
                "incidents_iris": "{{vars.incidents_data|json_query('[][\"@id\"][]')}}"
            },
            "status": null,
            "top": "327",
            "left": "34",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": "\/api\/3\/workflow_groups\/49dcc2d3-9ef2-41b5-bcfa-4d18b0324df5",
            "uuid": "8ad9e073-3ba4-4d38-823e-b74a480554d6"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Indicator Data",
            "description": null,
            "arguments": {
                "__get_inc_data": "{% for iri in vars.indicators_iris %}\n{%set incidents = (iri + '\/incidents?__selectFields=uuid') | fromIRI%}\n{%for entry in incidents['hydra:member'] %}\n{{vars.incidents_data.append(entry)}}\n{%endfor%}\n{%endfor%}"
            },
            "status": null,
            "top": "192",
            "left": "34",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": "\/api\/3\/workflow_groups\/49dcc2d3-9ef2-41b5-bcfa-4d18b0324df5",
            "uuid": "0236739d-876a-4508-8a99-821039ffd484"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Related Records",
            "description": null,
            "arguments": {
                "reporter_ip": "{{vars.event_data.reporterIP}}",
                "indicators_iris": "{{vars.event_data|json_query('indicators[][\"@id\"][]')}}",
                "search_keywords": "{{vars.event_data.searchKeywords}}"
            },
            "status": null,
            "top": "57",
            "left": "34",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": "\/api\/3\/workflow_groups\/49dcc2d3-9ef2-41b5-bcfa-4d18b0324df5",
            "uuid": "4032d4b4-bf46-49ab-91b9-94f412b49156"
        },
        {
            "@type": "WorkflowStep",
            "name": "Run Search Indicators and Get Their Related Events",
            "description": null,
            "arguments": {
                "arguments": {
                    "keywords": "{{vars.search_keywords}}",
                    "reptDevIpAddr": "{{vars.reporter_ip}}",
                    "incidents_iris": "{{vars.incidents_iris}}",
                    "parent_record_iri": "{{vars.input.records[0]['@id']}}"
                },
                "apply_async": false,
                "step_variables": {
                    "events_iris": "{{vars.steps.Run_Search_Indicators_and_Get_Their_Related_Events.events_iris}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/95bb5a82-e42f-453c-b4a7-2b047a153985"
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "dbc63ccc-75b3-4521-b4b8-f1b793f1835f"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "8419e8d3-6376-4d55-8bc4-1fc0e76f4466",
                "resources": [
                    "events"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    },
                    "event_data": "{{(vars.input.records[0]['@id']+\"?$relationships=true\")|fromIRI}}",
                    "incidents_data": "[]"
                },
                "displayConditions": {
                    "alerts": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": [
                            {
                                "type": "array",
                                "field": "type",
                                "value": [
                                    "\/api\/3\/picklists\/a043fb35-f373-44c0-bfa9-5bce2f711141",
                                    "\/api\/3\/picklists\/0cbc2c31-c360-4770-b1e7-3653a8c24ead"
                                ],
                                "module": "type",
                                "display": "",
                                "operator": "in",
                                "template": "multiselectpicklist",
                                "OPERATOR_KEY": "$",
                                "useInOperator": true,
                                "previousOperator": "in",
                                "previousTemplate": "multiselectpicklist"
                            }
                        ]
                    },
                    "events": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    },
                    "indicators": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": [
                            {
                                "type": "object",
                                "field": "typeofindicator",
                                "value": "\/api\/3\/picklists\/0162241b-f5bf-4917-a150-00e920be47bd",
                                "_value": {
                                    "@id": "\/api\/3\/picklists\/0162241b-f5bf-4917-a150-00e920be47bd",
                                    "itemValue": "File"
                                },
                                "operator": "eq"
                            }
                        ]
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "d70bf103-bfed-49bc-b1f6-b4a65913deb7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update Previous Comment",
            "description": null,
            "arguments": {
                "arguments": {
                    "comments_iris": "{{vars.steps._GC__Identify_Dropper_Origin['@id']}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/1349e234-0b21-4e57-b781-2c9f72a679f1"
            },
            "status": null,
            "top": "975",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "d29d714f-4f08-4a0e-82e1-74a07828a992"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "_GC_ Identify Dropper Origin -> Update Previous Comment",
            "targetStep": "\/api\/3\/workflow_steps\/d29d714f-4f08-4a0e-82e1-74a07828a992",
            "sourceStep": "\/api\/3\/workflow_steps\/ccb1ae24-6715-4075-bfb7-718e917ff833",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "80cb08f2-6ca2-4a56-a5fd-273749d52ec4"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Events IRIs -> _GC_ Identify Dropper Origin",
            "targetStep": "\/api\/3\/workflow_steps\/ccb1ae24-6715-4075-bfb7-718e917ff833",
            "sourceStep": "\/api\/3\/workflow_steps\/bdbb9062-8296-4710-a363-f7e04d9b4e56",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "4fc1bc54-2638-4b83-abe5-7d02183ff00d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Incidents IRI -> Run Create Indicators and Get Their Related Events",
            "targetStep": "\/api\/3\/workflow_steps\/dbc63ccc-75b3-4521-b4b8-f1b793f1835f",
            "sourceStep": "\/api\/3\/workflow_steps\/8ad9e073-3ba4-4d38-823e-b74a480554d6",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "4052a52f-2be5-43b7-8d40-5cff36c27e53"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Indicator Data -> Get Incidents IRI",
            "targetStep": "\/api\/3\/workflow_steps\/8ad9e073-3ba4-4d38-823e-b74a480554d6",
            "sourceStep": "\/api\/3\/workflow_steps\/0236739d-876a-4508-8a99-821039ffd484",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "a38bfc7d-c8a1-48ca-8cf3-4e116bcad4ed"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Related Records -> Get Incident Record IRI",
            "targetStep": "\/api\/3\/workflow_steps\/0236739d-876a-4508-8a99-821039ffd484",
            "sourceStep": "\/api\/3\/workflow_steps\/4032d4b4-bf46-49ab-91b9-94f412b49156",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "393cc2e1-e5e0-487f-954f-2674dd43cae5"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Run Create Indicators and Get Their Related Events -> Get Events IRIs",
            "targetStep": "\/api\/3\/workflow_steps\/bdbb9062-8296-4710-a363-f7e04d9b4e56",
            "sourceStep": "\/api\/3\/workflow_steps\/dbc63ccc-75b3-4521-b4b8-f1b793f1835f",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "7a8844ac-21c9-4dd8-8a2e-6c711e705fa6"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Get Related Records",
            "targetStep": "\/api\/3\/workflow_steps\/4032d4b4-bf46-49ab-91b9-94f412b49156",
            "sourceStep": "\/api\/3\/workflow_steps\/d70bf103-bfed-49bc-b1f6-b4a65913deb7",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "72a4a5ee-089c-414c-b2a5-5f7be7f8e344"
        }
    ],
    "groups": [
        {
            "@type": "WorkflowGroup",
            "name": "Get related records details",
            "description": "Fetches related records IDs so the playbook can post messages to all of them",
            "type": "block",
            "isCollapsed": false,
            "hasTriggerStep": false,
            "hideInLogs": false,
            "metadata": [],
            "reusable": false,
            "top": "108",
            "left": "91",
            "height": "419",
            "width": "324",
            "uuid": "49dcc2d3-9ef2-41b5-bcfa-4d18b0324df5",
            "recordTags": []
        },
        {
            "@type": "WorkflowGroup",
            "name": "Run Search Indicators",
            "description": "When a user uses a keyword for a SIEM search, the keyword will be stored in FortiSOAR as an indicator and all found events will be linked to it",
            "type": "note",
            "isCollapsed": false,
            "hasTriggerStep": false,
            "hideInLogs": true,
            "metadata": [],
            "reusable": false,
            "top": "560",
            "left": "420",
            "height": "97",
            "width": "498",
            "uuid": "1220ba37-0bd3-4953-98bd-78c89d6a35d5",
            "recordTags": []
        }
    ],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "0d6c2eaf-e2e5-4db7-b032-8d20e9fe7fe2",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Hunt"
    ]
}